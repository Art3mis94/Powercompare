<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Player Power</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: Inter, sans-serif; margin:0; background:#f8fafc; color:#1e293b; }
header { background:#1e40af; color:#fff; padding:1rem 1.5rem; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.25rem; }
header button { background:#ef4444; color:#fff; border:none; padding:.5rem 1rem; border-radius:6px; cursor:pointer; font-weight:600; }
main { max-width:600px; margin:1.25rem auto; padding:0 1rem; }
form { display:flex; flex-direction:column; gap:1rem; background:#fff; padding:1rem; border-radius:10px; box-shadow:0 4px 15px rgba(0,0,0,.08);}
input, select { padding:.6rem; border-radius:6px; border:1px solid #ccc; font-size:1rem; }
button.save { background:#3b82f6; color:#fff; border:none; padding:.6rem; font-weight:600; border-radius:6px; cursor:pointer; }
button.save:hover { background:#2563eb; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>

<header>
  <h1>Add Player Power</h1>
  <button id="signOutBtn">Sign Out</button>
</header>

<main>
  <form id="powerForm">
    <label>Player Name (select or type new):</label>
    <input type="text" id="playerName" placeholder="Enter player name or select from list" list="playerList" required>
    <datalist id="playerList"></datalist>

    <label>Date:</label>
    <input type="date" id="entryDate" required>

    <label>Power:</label>
    <input type="number" id="power" required min="0">

    <button type="submit" class="save">Save</button>
  </form>
</main>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAyhGftf_DfotmvL4iLx60NT98BjkbG6DM",
  authDomain: "powercompare-bafd9.firebaseapp.com",
  projectId: "powercompare-bafd9",
  storageBucket: "powercompare-bafd9.firebasestorage.app",
  messagingSenderId: "768897803088",
  appId: "1:768897803088:web:ff55aed87037cef6720255",
  measurementId: "G-09ENH5L0VG"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Redirect if not logged in
auth.onAuthStateChanged(user=>{
  if(!user) window.location.href = "login.html";
  else loadPlayers(user.uid);
});

// Sign out
document.getElementById("signOutBtn").addEventListener("click", ()=>{
  auth.signOut().then(()=>window.location.href="login.html");
});

// Load existing players for this user
async function loadPlayers(uid){
  const snapshot = await db.collection('powers').doc(uid).collection('entries').get();
  const players = [...new Set(snapshot.docs.map(d=>d.data().name))].sort();
  const datalist = document.getElementById("playerList");
  datalist.innerHTML = players.map(p=>`<option value="${p}">`).join('');
}

// Save new power entry
document.getElementById("powerForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const name = document.getElementById("playerName").value.trim();
  const date = document.getElementById("entryDate").value;
  const power = parseInt(document.getElementById("power").value);

  if(!name || !date || isNaN(power)) return alert("Please fill all fields.");

  const uid = auth.currentUser.uid;

  try{
    await db.collection('powers').doc(uid).collection('entries').add({
      name, date, power
    });
    alert("Saved!");
    document.getElementById("powerForm").reset();
    loadPlayers(uid); // refresh list
  }catch(err){
    console.error(err);
    alert("Error saving entry.");
  }
});
</script>
</body>
</html>