<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Power Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body{font-family:Inter,sans-serif;margin:0;padding:0;background:#f8fafc;color:#1e293b;}
header{background:#1e40af;color:#fff;padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;}
button{padding:.5rem 1rem;border:none;border-radius:6px;background:#3b82f6;color:#fff;cursor:pointer;}
button:hover{opacity:.9;}
main{max-width:800px;margin:1.5rem auto;padding:0 1rem;}
table{width:100%;border-collapse:collapse;margin-top:1rem;}
th,td{padding:.6rem;border-bottom:1px solid #ccc;text-align:left;}
input[type="text"],input[type="number"]{padding:.4rem .6rem;border:1px solid #ccc;border-radius:6px;width:120px;}
form{display:flex;gap:.5rem;align-items:center;margin-bottom:1rem;}
</style>
</head>
<body>

<header>
  <h1>Power Manager</h1>
  <button id="signOutBtn">Sign Out</button>
</header>

<main>
  <form id="addForm">
    <input type="text" id="playerName" placeholder="Player Name" required>
    <input type="number" id="playerPower" placeholder="Power" required>
    <button type="submit">Add Entry</button>
  </form>

  <table id="powerTable">
    <thead>
      <tr>
        <th>Player</th>
        <th>Power</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAyhGftf_DfotmvL4iLx60NT98BjkbG6DM",
  authDomain: "powercompare-bafd9.firebaseapp.com",
  projectId: "powercompare-bafd9",
  storageBucket: "powercompare-bafd9.appspot.com",
  messagingSenderId: "768897803088",
  appId: "1:768897803088:web:ff55aed87037cef6720255"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Redirect if not logged in
auth.onAuthStateChanged(user=>{
  if(!user) location.href="login.html";
  else loadEntries();
});

// Sign out
document.getElementById("signOutBtn").onclick = ()=> auth.signOut().then(()=>location.href="login.html");

// Add entry
document.getElementById("addForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const name = document.getElementById("playerName").value.trim();
  const power = Number(document.getElementById("playerPower").value);
  if(!name || !power) return;

  const entry = { name, power, date: new Date() };
  await db.collection('powers').add(entry);

  document.getElementById("playerName").value = '';
  document.getElementById("playerPower").value = '';
  loadEntries();
});

// Load all entries
async function loadEntries(){
  const snapshot = await db.collection('powers').orderBy('date','desc').get();
  const tbody = document.querySelector("#powerTable tbody");
  tbody.innerHTML = '';
  snapshot.forEach(doc=>{
    const d = doc.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${d.name}</td>
      <td>${d.power}</td>
      <td>${new Date(d.date.seconds*1000).toLocaleString()}</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>

</body>
</html>