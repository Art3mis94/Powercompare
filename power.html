<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add / Edit Player Power</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body { font-family: Inter, sans-serif; margin:0; background:#f8fafc; color:#1e293b; }
header { background:#1e40af; color:#fff; padding:1rem 1.5rem; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.25rem; }
nav { display:flex; justify-content:center; gap:10px; padding:0.75rem; background:#e2e8f0; }
nav a { color:#fff; text-decoration:none; padding:.6rem 1rem; background:#3b82f6; border-radius:6px; font-weight:600; }
nav a:hover { opacity:.9; transform:translateY(-1px); }
main { max-width:900px; margin:1.25rem auto; padding:0 1rem; }
form { display:flex; flex-direction:column; gap:.8rem; margin-bottom:1.5rem; background:#fff; padding:1rem; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.05); }
input, select { padding:.5rem; border:1px solid #ccc; border-radius:6px; font-size:1rem; }
button { padding:.5rem 1rem; border:none; border-radius:6px; background:#3b82f6; color:#fff; font-weight:600; cursor:pointer; }
button:hover { background:#2563eb; }
table { width:100%; border-collapse:collapse; }
th, td { padding:.6rem .8rem; text-align:left; border-bottom:1px solid #ccc; }
th { background:#e2e8f0; }
.actions button { margin-right:.5rem; background:#ef4444; }
.actions button.edit { background:#10b981; }
</style>
</head>

<body>
<header>
  <h1>Manage Player Power</h1>
</header>

<nav>
  <a href="index.html">Dashboard</a>
  <a href="compare.html">Compare</a>
</nav>

<main>
  <form id="playerForm">
    <label>Player Name</label>
    <select id="playerSelect"></select>

    <label>Power</label>
    <input type="number" id="powerInput" placeholder="Enter power" required />

    <button type="submit">Save</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Player</th>
        <th>Power</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="playerTable"></tbody>
  </table>
</main>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAyhGftf_DfotmvL4iLx60NT98BjkbG6DM",
  authDomain: "powercompare-bafd9.firebaseapp.com",
  projectId: "powercompare-bafd9",
  storageBucket: "powercompare-bafd9.firebasestorage.app",
  messagingSenderId: "768897803088",
  appId: "1:768897803088:web:ff55aed87037cef6720255",
  measurementId: "G-09ENH5L0VG"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// --- Google Sign-In Redirect ---
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = 'login.html';
  } else {
    loadPlayers();
  }
});

// Form & table references
const playerForm = document.getElementById('playerForm');
const playerSelect = document.getElementById('playerSelect');
const powerInput = document.getElementById('powerInput');
const playerTable = document.getElementById('playerTable');

let editId = null;

// Load existing players to select
function loadPlayers() {
  db.collection('powerData').get().then(snapshot => {
    const players = [...new Set(snapshot.docs.map(d => d.data().name))].sort();
    playerSelect.innerHTML = players.map(p => `<option value="${p}">${p}</option>`).join('');
    renderTable(snapshot.docs);
  });
}

// Render table
function renderTable(docs) {
  playerTable.innerHTML = docs.map(doc => {
    const data = doc.data();
    return `
      <tr>
        <td>${data.name}</td>
        <td>${data.power.toLocaleString()}</td>
        <td>${data.date}</td>
        <td class="actions">
          <button class="edit" data-id="${doc.id}">Edit</button>
          <button class="delete" data-id="${doc.id}">Delete</button>
        </td>
      </tr>
    `;
  }).join('');

  // Attach actions
  document.querySelectorAll('.edit').forEach(btn => {
    btn.onclick = () => {
      editId = btn.dataset.id;
      const doc = docs.find(d => d.id === editId).data();
      playerSelect.value = doc.name;
      powerInput.value = doc.power;
    };
  });

  document.querySelectorAll('.delete').forEach(btn => {
    btn.onclick = () => {
      if (confirm('Delete this entry?')) {
        db.collection('powerData').doc(btn.dataset.id).delete().then(loadPlayers);
      }
    };
  });
}

// Handle form submit
playerForm.onsubmit = e => {
  e.preventDefault();
  const name = playerSelect.value;
  const power = parseInt(powerInput.value, 10);
  const date = new Date().toISOString().split('T')[0];

  if (!name || !power) return;

  if (editId) {
    db.collection('powerData').doc(editId).update({name, power, date}).then(() => {
      editId = null;
      playerForm.reset();
      loadPlayers();
    });
  } else {
    db.collection('powerData').add({name, power, date}).then(() => {
      playerForm.reset();
      loadPlayers();
    });
  }
};
</script>
</body>
</html>